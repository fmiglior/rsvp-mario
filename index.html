<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Anivers√°rio do Murilo</title>

<style>
*{box-sizing:border-box}

body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:linear-gradient(#8ed6ff,#5db9ff);
min-height:100vh;
display:flex;
flex-direction:column;
align-items:center;
justify-content:flex-start;
padding:20px 15px 100px 15px;
color:#222;
}

.platform{
position:fixed;
bottom:0;
left:0;
right:0;
height:80px;
background:#2ecc40;
}

.wrap{width:100%;max-width:500px;}

.banner{
background:#ffcc00;
border-radius:20px;
padding:18px;
text-align:center;
box-shadow:0 8px 25px rgba(0,0,0,.25);
margin-bottom:20px;
}

.banner h1{margin:0;font-size:22px;color:#d90000;}
.banner p{margin-top:8px;font-size:14px;}

.card{
background:#ffffff;
border-radius:20px;
padding:20px;
box-shadow:0 10px 30px rgba(0,0,0,.25);
}

label{
display:block;
margin:14px 0 6px;
font-weight:bold;
font-size:14px;
}

input,select{
width:100%;
padding:12px;
border-radius:14px;
border:2px solid #ddd;
font-size:14px;
background:#fff;
color:#000;
}

.row{display:flex;gap:10px;}
.row > div{flex:1;}

button{
margin-top:18px;
width:100%;
padding:14px;
border:0;
border-radius:16px;
font-size:16px;
font-weight:bold;
cursor:pointer;
background:#e3000f;
color:#fff;
transition:.2s;
}

button:disabled{
opacity:.65;
cursor:not-allowed;
}

button:active{transform:scale(.98);}

.success{
margin-top:15px;
padding:12px;
background:#d4ffd4;
border-radius:12px;
color:#006600;
font-weight:bold;
text-align:center;
}

.error{
margin-top:15px;
padding:12px;
background:#ffe0e0;
border-radius:12px;
color:#8a0000;
font-weight:bold;
text-align:center;
}

.block{
width:45px;height:45px;
background:#ffcc00;
border:4px solid #c49b00;
border-radius:8px;
display:flex;align-items:center;justify-content:center;
font-weight:bold;font-size:24px;color:#c49b00;
position:absolute;right:-15px;top:-15px;
box-shadow:0 6px 12px rgba(0,0,0,.3);
}

.card-container{position:relative;}

.smallHint{
font-size:12px;
opacity:.75;
margin-top:8px;
}

@media (max-width:480px){
.banner h1{font-size:20px}
.row{flex-direction:column}
}
</style>
</head>

<body>
<div class="wrap">
  <div class="banner">
    <h1>Anivers√°rio do Murilo üéâ</h1>
    <p>Vai ser uma aventura incr√≠vel! Confirme sua presen√ßa üíõ</p>
  </div>

  <div class="card-container">
    <div class="block">?</div>

    <div class="card">
      <form id="rsvp">
        <label>Voc√™ vai?</label>
        <select id="vai" required>
          <option value="" disabled selected>Selecione</option>
          <option>Sim</option>
          <option>N√£o</option>
        </select>

        <label>Nome do respons√°vel</label>
        <input id="responsavel" required placeholder="Ex.: Mario Da Silva Bros"/>

        <div class="row">
          <div>
            <label>Quantos adultos (incluindo o respons√°vel)?</label>
            <select id="adultos">
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
            <div class="smallHint">O respons√°vel conta como Adulto 1.</div>
          </div>

          <div>
            <label>Quantas crian√ßas?</label>
            <select id="criancas">
              <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </div>
        </div>

        <div id="dyn"></div>

        <button type="submit" id="btn">Confirmar Presen√ßa ‚≠ê</button>

        <div id="msg"></div>
      </form>
    </div>
  </div>
</div>

<div class="platform"></div>

<script>
/* ================= CONFIG ================= */
const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbxNmmbp80OxpEg1_ZiYceoZN5bXO_D1JJj-aBLXj1wey8FPHOotr5-oHTJ-ujBCKjBV/exec";
const TOKEN = "MARIO_RSVP_2026"; // tem que ser igual no Apps Script
/* ========================================= */

const $ = id => document.getElementById(id);
const dyn = $("dyn");
const msg = $("msg");
const btn = $("btn");

function setMsg(html, kind="success"){
  msg.innerHTML = `<div class="${kind}">${html}</div>`;
}

function rebuildDyn(){
  dyn.innerHTML = "";

  const vai = $("vai").value;
  if (vai !== "Sim") return;

  // Respons√°vel sempre √© Adulto 1
  const responsavel = $("responsavel").value.trim();
  let a = Number($("adultos").value || 1);
  let c = Number($("criancas").value || 0);

  // Seguran√ßa: nunca permitir < 1 adulto se vai = Sim
  if (a < 1) {
    $("adultos").value = "1";
    a = 1;
  }

  // Adulto 1 = respons√°vel (auto)
  dyn.innerHTML += `<label>Adulto 1 (Respons√°vel)</label>
    <input id="adulto1" required readonly placeholder="Preenchido automaticamente" />`;

  // Preenche Adulto 1 com o nome do respons√°vel
  const a1 = document.getElementById("adulto1");
  if (a1) a1.value = responsavel;

  // Adultos adicionais (2..a)
  for (let i=2; i<=a; i++){
    dyn.innerHTML += `<label>Nome do Adulto ${i}</label>
      <input required placeholder="Adulto ${i}" data-kind="adulto_extra" />`;
  }

  // Crian√ßas (1..c)
  for (let i=1; i<=c; i++){
    dyn.innerHTML += `<label>Nome da Crian√ßa ${i}</label>
      <input required placeholder="Crian√ßa ${i}" data-kind="crianca" />`;
  }
}

["vai","adultos","criancas"].forEach(id=>{
  $(id).addEventListener("change", rebuildDyn);
});

// Quando digitar respons√°vel, atualiza Adulto 1 em tempo real
$("responsavel").addEventListener("input", ()=>{
  const a1 = document.getElementById("adulto1");
  if (a1) a1.value = $("responsavel").value.trim();
});

// Se escolher "N√£o", faz sentido zerar crian√ßas e adultos volta pra 1 (n√£o importa, mas deixa limpo)
$("vai").addEventListener("change", ()=>{
  if ($("vai").value === "N√£o") {
    $("criancas").value = "0";
    // adultos deixamos como 1 (inofensivo), e n√£o renderiza dyn de qualquer forma
    dyn.innerHTML = "";
  }
});

function simpleHash(s){
  let h=2166136261;
  for(let i=0;i<s.length;i++){
    h ^= s.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return (h>>>0).toString(16);
}

$("rsvp").addEventListener("submit", async (e)=>{
  e.preventDefault();
  msg.innerHTML = "";
  btn.disabled = true;
  btn.textContent = "Enviando...";

  const vai = $("vai").value;
  const responsavel = $("responsavel").value.trim();
  const adultos = Number($("adultos").value || 1);
  const criancas = Number($("criancas").value || 0);

  // Se vai = Sim, Adulto 1 √© respons√°vel e √© obrigat√≥rio
  if (vai === "Sim" && !responsavel) {
    setMsg("Preencha o nome do respons√°vel üôÇ", "error");
    btn.disabled = false; btn.textContent = "Confirmar Presen√ßa ‚≠ê";
    return;
  }

  // Coletar nomes:
  // Adulto 1:
  const nomesAdultos = [];
  if (vai === "Sim") nomesAdultos.push(responsavel);

  // Adultos extra:
  const extraAdults = Array.from(dyn.querySelectorAll('input[data-kind="adulto_extra"]'))
    .map(x=>x.value.trim()).filter(Boolean);

  // Crian√ßas:
  const kids = Array.from(dyn.querySelectorAll('input[data-kind="crianca"]'))
    .map(x=>x.value.trim()).filter(Boolean);

  if (vai === "Sim") {
    if (1 + extraAdults.length !== adultos) {
      setMsg("Preencha os nomes de todos os adultos üôÇ", "error");
      btn.disabled = false; btn.textContent = "Confirmar Presen√ßa ‚≠ê";
      return;
    }
    if (kids.length !== criancas) {
      setMsg("Preencha os nomes de todas as crian√ßas üôÇ", "error");
      btn.disabled = false; btn.textContent = "Confirmar Presen√ßa ‚≠ê";
      return;
    }
  }

  nomesAdultos.push(...extraAdults);

  const payload = {
    token: TOKEN,
    vai,
    responsavel,
    adultos: (vai === "Sim") ? adultos : 0,
    criancas: (vai === "Sim") ? criancas : 0,
    nomes_adultos: (vai === "Sim") ? nomesAdultos.join(", ") : "",
    nomes_criancas: (vai === "Sim") ? kids.join(", ") : "",
  };

  payload.hash = simpleHash(JSON.stringify(payload));

  try{
    const res = await fetch(ENDPOINT_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json().catch(()=> ({}));
    if(!res.ok || !data.ok) throw new Error(data.error || ("HTTP " + res.status));

    setMsg("üéâ Presen√ßa confirmada com sucesso!<br/>Estamos muito felizes em celebrar com voc√™s! ‚≠êüçÑ", "success");

    $("rsvp").reset();
    $("adultos").value = "1";
    $("criancas").value = "0";
    dyn.innerHTML = "";
  } catch(err){
    setMsg("Ops! N√£o consegui enviar agora. Tente novamente em alguns segundos.", "error");
  } finally {
    btn.disabled = false;
    btn.textContent = "Confirmar Presen√ßa ‚≠ê";
  }
});
</script>
</body>
</html>
